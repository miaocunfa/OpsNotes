---
title: "版本回退脚本"
date: "2020-06-12"
categories:
    - "技术"
tags:
    - "shell"
toc: false
indent: false
original: true
---

## shell版

``` shell
#!/bin/bash

version_json="/home/miaocunfa/bin/version.json"
version=$(cat $version_json | jq -r '.version')

function __exit_handler()
{
    echo
    echo -e "\tQuit the Program!"
    echo

    exit $EXITCODE

} # End of exit_handler function

function __get_answer()
{

    unset ANSWER
    ASK_COUNT=0

    while [ -z "$ANSWER" ] # While no answer is given, keep asking.
    do
        echo

        ASK_COUNT=$[ $ASK_COUNT + 1 ]

        case $ASK_COUNT in
        2)  
            echo "请回答这个问题！"
        ;;

        3)  
            echo "再次尝试！请回答这个问题！"
        ;;

        4)  
            echo "因为你拒绝回答这个问题...."
            __exit_handler                     # function transfer
        ;;
        esac

        if [ -n "$LINE2" ]
        then
            echo -e "\t"$LINE1
            echo -e "\t"$LINE2" \c"
        else
            echo -e "\t"$LINE1" \c"
        fi

        # allow 30 seconds to answer before time-out
        read -t 30 ANSWER
    done

    # Do a little variable clean-up
    unset LINE1
    unset LINE2
} # End of get_answer function


function __process_answer()
{
    case $ANSWER in

    y|Y|YES|yes|Yes|yEs|yeS|YEs|yES)          # If user answer "yes", do nothing.
        echo
        echo -e "\t确认操作, 继续处理!"
        isAll="0"
    ;;

    n|N|NO|no|No|nO)                          # If user answer "no", do nothing.
        echo
        echo -e "\t否定操作, 继续处理!"
        isAll="1"
    ;;

    *)                                        # If user answer anything but "yes" or "no", exit script.
        echo
        echo -e "\t"$EXIT_LINE1
        echo -e "\t"$EXIT_LINE2
        __exit_handler                        # function transfer
    ;;

    esac

    # Do a little variable clean-up
    unset EXIT_LINE1
    unset EXIT_LINE2

} # End of process_answer function


LINE1="是否要回退全部版本!(yes/no)"

EXIT_LINE1="因为你没有正确输入答案!"
EXIT_LINE2="所以，退出这个脚本!"

__get_answer
__process_answer

if [ $isAll == '0' ]
then
    echo -e "\t所有服务回退!"
else
    echo -e "\t单服务回退!"

    LINE1="请输入您要回退的服务!"
    __get_answer
    rollback=$ANSWER

    if [ $rollback == 'info-message-service.jar' ]
    then
        echo -e "\t此次版本升级中存在该服务，正在回退!"
    else
        echo -e "\t此次版本升级中不存在该服务，脚本退出!"
        __exit_handler
    fi
fi
```

## python版

``` py

prompt = "\nIf you could visit one place in the world,"
prompt += "where would you go?"
prompt += "\n(Enter 'quit' when you are finished.) "

dream_travel = []
active = True

while active:
    place = raw_input(prompt)

    if place != 'quit':
        dream_travel.append(place)
    else:
        break

if dream_travel:
    print("")
    for place in dream_travel:
        print(place)
else:
    print("\nYou haven't said where you're going!")

```
